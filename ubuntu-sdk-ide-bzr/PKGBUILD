# Maintainer: Luca Weiss <luca (at) z3ntu (dot) xyz>

pkgname=ubuntu-sdk-ide-bzr
_pkgname=ubuntu-sdk-ide
pkgver=r143
pkgrel=1
pkgdesc="Integrated development environment for Ubuntu"
url="https://launchpad.net/ubuntu-sdk-ide"
arch=('x86_64' 'i686')
license=('LGPL3')
makedepends=('go' 'bzr' 'git' 'cmake' 'postgresql-libs' 'libmariadbclient' 'freetds' 'lttng-ust' 'libnih' 'extra-cmake-modules' 'fcitx' 'doxygen' 'botan-1.10' 'chrpath'
'mtdev' 'libfbclient' 'libmariadbclient' 'sqlite' 'unixodbc' 'postgresql-libs' 'alsa-lib' 'gst-plugins-base-libs')
depends=("lxd" "ubuntu-sdk-tools")
# options='!emptydirs'
provides=("ubuntu-sdk-ide" "qtcreator" "qtchooser")
conflicts=("ubuntu-sdk-ide" "qtcreator" "qtchooser")
source=("bzr+lp:ubuntu-sdk-ide"
        "0001.patch")
md5sums=('SKIP'
         'ced706308b6a95872fc46a23304d458d')

pkgver() {
  cd $srcdir/$_pkgname
  printf "r%s" "$(bzr revno)"
}

prepare() {
  cd $srcdir/$_pkgname
  if ! patch -R -p0 --dry-run <../0001.patch; then
    patch -Np0 < ../0001.patch
  fi
#  shebang_patch=(
#    dist/qtcreator/scripts/deployqt.py
#  )
#  for file in ${shebang_patch[@]}; do
#    echo "Replacing #!/usr/bin/python with #!/usr/bin/python2: $file"
#    sed -i 's@^#!.*python$@#!/usr/bin/python2@' $file
#  done
  sed -i 's/python /python2 /' dist/qtcreator/qtcreator.pro
}

build() {
  mkdir -p $srcdir/$_pkgname/build
  cd $srcdir/$_pkgname/build
  cmake -DCMAKE_INSTALL_PREFIX='/usr' ..
  make
}

package() {
  cd $srcdir/$_pkgname
#  make DESTDIR="$pkgdir/" install
#  cmake -p cmake_install.cmake
  cp -R build/ubuntu-sdk-ide $pkgdir/usr
}

# vim:set ts=2 sw=2 et:
