From 84549b55fc070645c6ba7a5d9da02e97734e5d6e Mon Sep 17 00:00:00 2001
From: Javier Llorente <javier@opensuse.org>
Date: Wed, 28 Nov 2018 01:05:53 +0100
Subject: [PATCH] Fix issue #4: 'Protocol "" is unknown' during login

---
 src/gui/mainwindow.cpp | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/gui/mainwindow.cpp b/src/gui/mainwindow.cpp
index 588334c..c8353ff 100644
--- a/src/gui/mainwindow.cpp
+++ b/src/gui/mainwindow.cpp
@@ -21,6 +21,8 @@
 #include "mainwindow.h"
 #include "ui_mainwindow.h"
 
+const QString defaultApiUrl = "https://api.opensuse.org";
+
 MainWindow::MainWindow(QWidget *parent) :
     QMainWindow(parent),
     ui(new Ui::MainWindow)
@@ -1456,7 +1458,12 @@ void MainWindow::readAuthSettings()
     qDebug() << "MainWindow::readAuthSettings()";
     QSettings settings;
     settings.beginGroup("Auth");
-    obs->setApiUrl(settings.value("ApiUrl").toString());
+    QString apiUrl = settings.value("ApiUrl").toString();
+    if (apiUrl.isEmpty()) {
+        apiUrl = defaultApiUrl;
+        settings.setValue("ApiUrl", defaultApiUrl);
+    }
+    obs->setApiUrl(apiUrl);
     if (settings.value("AutoLogin").toBool()) {
         Credentials *credentials = new Credentials(this);
         connect(credentials, SIGNAL(errorReadingPassword(QString)),
-- 
2.19.2
